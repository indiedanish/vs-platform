import{b as D,c as Y,u as F,d as J,r as n,j as e,B as m,a as j,A,e as M,f as R}from"./index-DJZj13a9.js";import{C as _,b as X,c as K,a as O}from"./card-C5JX6E1Y.js";import{T as q}from"./textarea-L0q8ZsWw.js";import{c as k,a as r,C as ee,S as P,B as Z}from"./skeleton-Bc1dlZ9k.js";import{v as se,A as G}from"./arrow-left-DNGmpU0m.js";import{E as ae}from"./eye-h43dRJCD.js";class te{async getVideoRatings(c,l={}){try{const a={};return l.page&&(a.page=l.page.toString()),l.limit&&(a.limit=l.limit.toString()),await D.get(`/videos/${c}/ratings`,a)}catch(a){throw console.error("Get video ratings error:",a),a}}async rateVideo(c,l){try{return await D.post(`/videos/${c}/ratings`,l)}catch(a){throw console.error("Rate video error:",a),a}}}const re=new te;/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],le=Y("send",ie),he=()=>{const{id:i}=F(),{user:c,isAuthenticated:l}=J(),[a,H]=n.useState(null),[x,g]=n.useState([]),[L,u]=n.useState(!0),[V,f]=n.useState(!0),[o,p]=n.useState(""),[N,v]=n.useState(!1),[d,B]=n.useState(0),[U,y]=n.useState(0);n.useEffect(()=>{i&&(w(i),T(i))},[i]);const w=async s=>{u(!0);try{const t=await se.getVideoById(s);H(t)}catch(t){console.error("Error loading video:",t)}finally{u(!1)}},T=async s=>{f(!0);try{const t=await k.getVideoComments(s,{limit:50});g(t)}catch(t){console.error("Error loading comments:",t)}finally{f(!1)}},W=async s=>{if(s.preventDefault(),!(!o.trim()||!c||!i)){v(!0);try{const t=await k.addComment(i,{content:o.trim()});g(b=>[...b,t]),p("")}catch(t){console.error("Error submitting comment:",t)}finally{v(!1)}}},$=async s=>{if(!(!l||!i)){B(s);try{await re.rateVideo(i,{rating:s}),console.log(`User rated video ${s} stars`),i&&w(i)}catch(t){console.error("Error submitting rating:",t)}}},E=s=>s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(1)}K`:s.toString(),z=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),Q=s=>{const t=new Date(s),h=Math.abs(new Date().getTime()-t.getTime()),C=Math.floor(h/(1e3*60)),S=Math.floor(h/(1e3*60*60)),I=Math.floor(h/(1e3*60*60*24));return C<60?`${C}m ago`:S<24?`${S}h ago`:I<7?`${I}d ago`:t.toLocaleDateString()};return L?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(r,{className:"h-8 w-32 mb-6"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(r,{className:"w-full aspect-video rounded-lg mb-6"}),e.jsx(r,{className:"h-8 w-3/4 mb-4"}),e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx(r,{className:"h-4 w-24"}),e.jsx(r,{className:"h-4 w-32"}),e.jsx(r,{className:"h-4 w-20"})]}),e.jsx(r,{className:"h-20 w-full"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"h-6 w-32 mb-4"}),e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((s,t)=>e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(r,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(r,{className:"h-4 w-24 mb-2"}),e.jsx(r,{className:"h-12 w-full"})]})]},t))})]})]})]})}):a?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(m,{variant:"ghost",asChild:!0,className:"mb-6",children:e.jsxs(j,{to:"/",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Back to Videos"]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("div",{className:"relative bg-black rounded-lg overflow-hidden mb-6",children:e.jsxs("video",{controls:!0,autoPlay:!0,className:"w-full aspect-video",poster:a.thumbnailUrl||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQ1MCIgdmlld0JveD0iMCAwIDgwMCA0NTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI4MDAiIGhlaWdodD0iNDUwIiBmaWxsPSIjMDAwMDAwIi8+Cjx0ZXh0IHg9IjQwMCIgeT0iMjI1IiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiNGRkZGRkYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlZpZGVvIFBsYXllcjwvdGV4dD4KPC9zdmc+",preload:"metadata",children:[e.jsx("source",{src:a.videoUrl,type:"video/mp4"}),"Your browser does not support the video tag."]})}),e.jsxs("div",{className:"bg-white rounded-lg p-6 mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:a.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsxs("span",{children:[E(a.views)," views"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:z(a.createdAt)})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(P,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),e.jsxs("span",{children:[a.averageRating.toFixed(1)," rating (",a.totalRatings," votes)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Creator:"})," ",a.creator.username]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Description:"})," ",a.description||"No description available"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",a.duration?`${Math.floor(a.duration/60)}:${(a.duration%60).toString().padStart(2,"0")}`:"Unknown"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Categories"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(Z,{variant:"secondary",children:a.isPublic?"Public":"Private"}),e.jsxs(Z,{variant:"outline",children:[a.totalRatings," rating",a.totalRatings!==1?"s":""]})]})]})]}),l&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Rate this video"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[[1,2,3,4,5].map(s=>e.jsx("button",{onClick:()=>$(s),onMouseEnter:()=>y(s),onMouseLeave:()=>y(0),className:"p-1 transition-colors",children:e.jsx(P,{className:`h-6 w-6 ${s<=(U||d)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},s)),d>0&&e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:["You rated this ",d," star",d!==1?"s":""]})]})]})]})]}),e.jsx("div",{children:e.jsxs(_,{children:[e.jsx(X,{children:e.jsx(K,{className:"flex items-center justify-between",children:e.jsxs("span",{children:["Comments (",x.length,")"]})})}),e.jsxs(O,{children:[l?e.jsx("form",{onSubmit:W,className:"mb-6",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(A,{className:"h-8 w-8",children:[e.jsx(M,{src:c?.avatar,alt:c?.firstName}),e.jsx(R,{children:c?.firstName?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(q,{placeholder:"Add a comment...",value:o,onChange:s=>p(s.target.value),className:"min-h-[80px] resize-none"}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx(m,{type:"submit",size:"sm",disabled:!o.trim()||N,children:N?"Posting...":e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Post"]})})})]})]})}):e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg text-center",children:[e.jsx("p",{className:"text-gray-600 mb-2",children:"Sign in to leave a comment"}),e.jsx(m,{asChild:!0,size:"sm",children:e.jsx(j,{to:"/login",children:"Sign In"})})]}),e.jsx("div",{className:"space-y-4",children:V?Array.from({length:3}).map((s,t)=>e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(r,{className:"h-8 w-8 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(r,{className:"h-4 w-24 mb-2"}),e.jsx(r,{className:"h-12 w-full"})]})]},t)):x.length>0?x.map(s=>e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(A,{className:"h-8 w-8",children:[e.jsx(M,{src:s.user?.avatar,alt:s.user.username}),e.jsx(R,{children:s.user.username.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:s.user.username}),e.jsx("span",{className:"text-xs text-gray-500",children:Q(s.createdAt)})]}),e.jsx("p",{className:"text-sm text-gray-700",children:s.content})]})]},s.id)):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No comments yet. Be the first to comment!"})})})]})]})})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Video not found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The video you're looking for doesn't exist."}),e.jsx(m,{asChild:!0,children:e.jsxs(j,{to:"/",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Back to Home"]})})]})})};export{he as default};
