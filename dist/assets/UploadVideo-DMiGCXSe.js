import{b as H,c as E,r as m,j as e,k as W,P as I,g as q,d as J,i as X,B as f,a as j,U as P,I as K}from"./index-DJZj13a9.js";import{C as F,a as C,b as Y,c as Q,d as Z}from"./card-C5JX6E1Y.js";import{A as ee,a as se,L as h}from"./alert-DXNIAuY4.js";import{T as ae}from"./textarea-L0q8ZsWw.js";import{S as re,a as te,b as ie,c as le,d as S}from"./select-Cr9rPIAG.js";import{A as oe,v as ne}from"./arrow-left-DNGmpU0m.js";class de{async uploadVideo(t,d,a){try{const r=new FormData;return r.append("video",t),r.append("videoId",d),a?this.uploadWithProgress(r,a):await H.postFormData("/upload/video",r)}catch(r){throw console.error("Upload video error:",r),r}}uploadWithProgress(t,d){return new Promise((a,r)=>{const i=new XMLHttpRequest;i.upload.addEventListener("progress",l=>{if(l.lengthComputable){const c=Math.round(l.loaded/l.total*100);d(c)}}),i.addEventListener("load",()=>{if(i.status>=200&&i.status<300)try{const l=JSON.parse(i.responseText);a(l)}catch{r(new Error("Invalid JSON response"))}else try{const l=JSON.parse(i.responseText);r(new Error(l.error||`HTTP ${i.status}: ${i.statusText}`))}catch{r(new Error(`HTTP ${i.status}: ${i.statusText}`))}}),i.addEventListener("error",()=>{r(new Error("Network error occurred"))});const p=localStorage.getItem("authToken");i.open("POST","http://localhost:3000/api/upload/video"),p&&i.setRequestHeader("Authorization",`Bearer ${p}`),i.send(t)})}validateVideoFile(t){return["video/mp4","video/webm","video/ogg","video/avi","video/mov"].includes(t.type)?t.size>104857600?{isValid:!1,error:"File size too large. Maximum size is 100MB."}:{isValid:!0}:{isValid:!1,error:"Invalid file type. Please upload MP4, WebM, OGG, AVI, or MOV files."}}}const V=new de;/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ue=E("circle-check-big",ce);/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],me=E("video",pe);var y="Progress",N=100,[xe,Se]=W(y),[he,ve]=xe(y),A=m.forwardRef((s,t)=>{const{__scopeProgress:d,value:a=null,max:r,getValueLabel:i=fe,...p}=s;(r||r===0)&&!M(r)&&console.error(ge(`${r}`,"Progress"));const l=M(r)?r:N;a!==null&&!T(a,l)&&console.error(je(`${a}`,"Progress"));const c=T(a,l)?a:null,v=g(c)?i(c,l):void 0;return e.jsx(he,{scope:d,value:c,max:l,children:e.jsx(I.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":g(c)?c:void 0,"aria-valuetext":v,role:"progressbar","data-state":k(c,l),"data-value":c??void 0,"data-max":l,...p,ref:t})})});A.displayName=y;var U="ProgressIndicator",$=m.forwardRef((s,t)=>{const{__scopeProgress:d,...a}=s,r=ve(U,d);return e.jsx(I.div,{"data-state":k(r.value,r.max),"data-value":r.value??void 0,"data-max":r.max,...a,ref:t})});$.displayName=U;function fe(s,t){return`${Math.round(s/t*100)}%`}function k(s,t){return s==null?"indeterminate":s===t?"complete":"loading"}function g(s){return typeof s=="number"}function M(s){return g(s)&&!isNaN(s)&&s>0}function T(s,t){return g(s)&&!isNaN(s)&&s<=t&&s>=0}function ge(s,t){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${N}\`.`}function je(s,t){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${N} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var L=A,ye=$;const O=m.forwardRef(({className:s,value:t,...d},a)=>e.jsx(L,{ref:a,className:q("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",s),...d,children:e.jsx(ye,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));O.displayName=L.displayName;const Ve=()=>{const{user:s,isAuthenticated:t}=J(),d=X(),[a,r]=m.useState({title:"",description:"",isPublic:!0,videoFile:null}),[i,p]=m.useState({}),[l,c]=m.useState(!1),[v,b]=m.useState(0),[D,R]=m.useState(!1);m.useEffect(()=>{(!t||s?.role!=="CREATOR")&&d("/")},[t,s,d]);const w=o=>{const{name:n,value:x}=o.target;r(u=>({...u,[n]:x})),i[n]&&p(u=>({...u,[n]:""}))},B=o=>{const n=o.target.files?.[0];if(n){const x=V.validateVideoFile(n);if(!x.isValid){p(u=>({...u,videoFile:x.error||"Invalid file"}));return}r(u=>({...u,videoFile:n})),i.videoFile&&p(u=>({...u,videoFile:""}))}},_=()=>{const o={};return a.title.trim()||(o.title="Title is required"),a.videoFile||(o.videoFile="Please select a video file"),p(o),Object.keys(o).length===0},z=async o=>{if(o.preventDefault(),!!_()&&a.videoFile){c(!0),b(0);try{const n=await ne.createVideo({title:a.title.trim(),description:a.description.trim()||"",isPublic:a.isPublic});await V.uploadVideo(a.videoFile,n.id,x=>b(x)),R(!0),setTimeout(()=>{d("/")},2e3)}catch(n){console.error("Upload error:",n),p({general:"Upload failed. Please try again."})}finally{c(!1)}}},G=o=>{if(o===0)return"0 Bytes";const n=1024,x=["Bytes","KB","MB","GB"],u=Math.floor(Math.log(o)/Math.log(n));return parseFloat((o/Math.pow(n,u)).toFixed(2))+" "+x[u]};return!t||s?.role!=="CREATOR"?null:D?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(F,{className:"max-w-md w-full",children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"mx-auto h-16 w-16 text-green-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Upload Complete!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Your video has been uploaded successfully and is now available for viewing."}),e.jsx(f,{asChild:!0,children:e.jsx(j,{to:"/",children:"Go to Home"})})]})})})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(f,{variant:"ghost",asChild:!0,className:"mb-6",children:e.jsxs(j,{to:"/",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Back to Home"]})}),e.jsxs(F,{children:[e.jsxs(Y,{children:[e.jsxs(Q,{className:"flex items-center space-x-2",children:[e.jsx(me,{className:"h-6 w-6"}),e.jsx("span",{children:"Upload Video"})]}),e.jsx(Z,{children:"Share your video with the CloudVideoShare community"})]}),e.jsx(C,{children:e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[i.general&&e.jsx(ee,{variant:"destructive",children:e.jsx(se,{children:i.general})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"videoFile",children:"Video File"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[e.jsx("input",{id:"videoFile",type:"file",accept:"video/*",onChange:B,className:"hidden"}),e.jsxs(h,{htmlFor:"videoFile",className:"cursor-pointer flex flex-col items-center space-y-2",children:[e.jsx(P,{className:"h-10 w-10 text-gray-400"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Click to upload a video"}),e.jsx("p",{className:"text-xs text-gray-500",children:"MP4, WebM, OGG, AVI, MOV up to 100MB"})]})]})]}),a.videoFile&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Selected: ",a.videoFile.name," (",G(a.videoFile.size),")"]}),i.videoFile&&e.jsx("p",{className:"text-sm text-red-600",children:i.videoFile})]}),l&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Uploading..."}),e.jsxs("span",{children:[Math.round(v),"%"]})]}),e.jsx(O,{value:v,className:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"title",children:"Title *"}),e.jsx(K,{id:"title",name:"title",value:a.title,onChange:w,placeholder:"Enter video title",className:i.title?"border-red-500":"",disabled:l}),i.title&&e.jsx("p",{className:"text-sm text-red-600",children:i.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"isPublic",children:"Visibility"}),e.jsxs(re,{value:a.isPublic?"public":"private",onValueChange:o=>r(n=>({...n,isPublic:o==="public"})),disabled:l,children:[e.jsx(te,{children:e.jsx(ie,{placeholder:"Select visibility"})}),e.jsxs(le,{children:[e.jsx(S,{value:"public",children:"Public - Anyone can view"}),e.jsx(S,{value:"private",children:"Private - Only you can view"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"description",children:"Description"}),e.jsx(ae,{id:"description",name:"description",value:a.description,onChange:w,placeholder:"Enter video description (optional)",rows:4,disabled:l})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(f,{type:"button",variant:"outline",asChild:!0,disabled:l,children:e.jsx(j,{to:"/",children:"Cancel"})}),e.jsx(f,{type:"submit",disabled:l,className:"min-w-[120px]",children:l?"Uploading...":e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Upload Video"]})})]})]})})]})]})})};export{Ve as default};
